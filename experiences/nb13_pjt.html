---
layout: default
---
{% include exp-header.html %}
  <article class="post">
    {% include exp-list.html %}
<h1 id="7️⃣ 상표 이미지 도형 코드 검출 모델 개발">7️⃣상표 이미지 도형 코드 검출 모델 개발</h1>
<p class="meta"><small>📅 2023.08 ~ 2023.11</small></p><hr/>
  <ul>
    <h3>📚 사용 스택</h3>
    <table>
      <tr>
        <td><img src="https://img.shields.io/badge/Python-3776AB.svg?&style=for-the-badge&logo=Python&logoColor=white"/></td>
        <td><img src="https://img.shields.io/badge/PyTorch-EE4C2C.svg?&style=for-the-badge&logo=PyTorch&logoColor=white"/></td>
        <td><img src="https://img.shields.io/badge/Pandas-150458.svg?&style=for-the-badge&logo=Pandas&logoColor=white"/></td>
        <td><img src="https://img.shields.io/badge/OpenCV-5C3EE8.svg?&style=for-the-badge&logo=OpenCV&logoColor=white"/></td>
        <td><img src="https://img.shields.io/badge/Docker-2496ED.svg?&style=for-the-badge&logo=Docker&logoColor=white"/></td>
        <td><img src="https://img.shields.io/badge/mongodb-47A248.svg?&style=for-the-badge&logo=MongoDB&logoColor=white"/></td>
        <td><img src="https://img.shields.io/badge/Jupyter-F37626.svg?&style=for-the-badge&logo=Jupyter&logoColor=white"/></td>
      </tr>
    </table>
    <br><br>

    <h3>💻 개발 환경</h3>
      <img src="https://img.shields.io/badge/Ubuntu-E95420.svg?&style=for-the-badge&logo=ubuntu&logoColor=white"/>
    <br><br>

    <h3>👥 개인 프로젝트 </h3>
    <small><b>AI 엔지니어 1</b></small>
    <br><br>
      <ul>
        <li> 2023 2차년도 인공지능 학습용 데이터 개발 정부사업(사업비 13.5억)의 일환으로 상표 이미지 도형 코드 검출 모델 개발</li>
          <ol>
            <li>YOLOv8: 중분류 클래스 24개 검출 모델</li>
            <li>EfficientNet: 중분류 별 소분류 클래스 다중 분류 모델 (총 24개)</li>
          </ol>
        <li>약 50만장 해외 상표 이미지 데이터에서 80%의 비율을 차지하는 상위 24개의 도형 코드를 타겟으로 설정</li>
        <li> 데이터 분석, YOLOv8 학습 및 검증, 다중 클래스 분류 모델(EfficientNetB3) 학습 및 검증</li>
        <li> 모델 검증을 위한 Docker build, export </li>
      </ul>
    <br>
    <p>데이터 정제 코드 일부</p>
    제외할 조건들을 condition 함수를 이용해 필터링, 오타 등으로 잘못 입력된 데이터가 존재할 수 있으므로 도형 코드 목록의 key값에 존재하는 값만 포함
    <div class="colorscripter-code" style="color:#f0f0f0;font-family:나눔고딕코딩 !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #4f4f4f"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#aaa;font-family:나눔고딕코딩 !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div><div style="line-height:130%">17</div><div style="line-height:130%">18</div><div style="line-height:130%">19</div><div style="line-height:130%">20</div><div style="line-height:130%">21</div><div style="line-height:130%">22</div><div style="line-height:130%">23</div><div style="line-height:130%">24</div><div style="line-height:130%">25</div><div style="line-height:130%">26</div><div style="line-height:130%">27</div><div style="line-height:130%">28</div><div style="line-height:130%">29</div><div style="line-height:130%">30</div><div style="line-height:130%">31</div><div style="line-height:130%">32</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:나눔고딕코딩 !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">def</span>&nbsp;condition(vienna):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;vienna[:<span style="color:#c10aff">2</span>]&nbsp;<span style="color:#ff3399">in</span>&nbsp;[<span style="color:#ffd500">'01'</span>,&nbsp;<span style="color:#ffd500">'25'</span>,&nbsp;<span style="color:#ffd500">'26'</span>,&nbsp;<span style="color:#ffd500">'27'</span>,&nbsp;<span style="color:#ffd500">'28'</span>,&nbsp;<span style="color:#ffd500">'29'</span>,&nbsp;<span style="color:#ffd500">'98'</span>]:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;<span style="color:#4be6fa">True</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;vienna[:<span style="color:#c10aff">4</span>]&nbsp;<span style="color:#ff3399">in</span>&nbsp;[<span style="color:#ffd500">'2403'</span>,&nbsp;<span style="color:#ffd500">'2413'</span>,&nbsp;<span style="color:#ffd500">'2415'</span>,&nbsp;<span style="color:#ffd500">'2417'</span>]:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;<span style="color:#4be6fa">True</span>&nbsp;<span style="color:#999999">#&nbsp;제외해야&nbsp;될&nbsp;것</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;vienna[:<span style="color:#c10aff">4</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'0903'</span>:&nbsp;<span style="color:#999999">#&nbsp;의류</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;<span style="color:#4be6fa">True</span>&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;vienna[:<span style="color:#c10aff">4</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'0503'</span>:&nbsp;<span style="color:#999999">#&nbsp;나뭇잎</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;<span style="color:#4be6fa">True</span>&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;vienna[:<span style="color:#c10aff">4</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'0207'</span>:&nbsp;<span style="color:#999999">#&nbsp;그룹,&nbsp;단체</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;<span style="color:#4be6fa">True</span>&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;vienna&nbsp;<span style="color:#ff3399">in</span>&nbsp;[<span style="color:#ffd500">'050701'</span>,&nbsp;<span style="color:#ffd500">'050702'</span>,&nbsp;<span style="color:#ffd500">'050703'</span>,&nbsp;<span style="color:#ffd500">'050705'</span>,&nbsp;<span style="color:#ffd500">'050709'</span>,&nbsp;<span style="color:#ffd500">'050721'</span>,&nbsp;<span style="color:#ffd500">'050722'</span>,&nbsp;<span style="color:#ffd500">'050725'</span>,&nbsp;<span style="color:#ffd500">'050726'</span>]:&nbsp;<span style="color:#999999">#&nbsp;곡물,&nbsp;기타과일제외</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;<span style="color:#4be6fa">True</span>&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;vienna[:<span style="color:#c10aff">4</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'2409'</span>&nbsp;<span style="color:#ff3399">and</span>&nbsp;vienna&nbsp;<span style="color:#ff3399">not</span>&nbsp;<span style="color:#ff3399">in</span>&nbsp;[<span style="color:#ffd500">'240901'</span>,&nbsp;<span style="color:#ffd500">'240902'</span>]:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;<span style="color:#4be6fa">True</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;<span style="color:#4be6fa">False</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">desc&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;dict()</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">for</span>&nbsp;v&nbsp;<span style="color:#ff3399">in</span>&nbsp;<span style="color:#4be6fa">range</span>(<span style="color:#c10aff">1</span>,&nbsp;<span style="color:#c10aff">29</span>):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#4be6fa">str</span>(v).zfill(<span style="color:#c10aff">2</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;desc&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;dict(desc,&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">*</span><span style="color:#0086b3"></span><span style="color:#ff3399">*</span>data[<span style="color:#ffd500">'SUB'</span>][v])</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;desc&nbsp;:도형코드의&nbsp;의미가&nbsp;저장되어&nbsp;있는&nbsp;딕셔너리.&nbsp;대분류는&nbsp;'MAIN',&nbsp;중분류는&nbsp;'MID',&nbsp;소분류는&nbsp;'SUB'라는&nbsp;key로&nbsp;저장되어&nbsp;있으며&nbsp;각&nbsp;key&nbsp;값의&nbsp;value는&nbsp;{도형코드:의미}&nbsp;형태의&nbsp;딕셔너리.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;desc&nbsp;=&nbsp;{'MAIN':{'01':&nbsp;'천체,&nbsp;자연현상,&nbsp;지도',&nbsp;...,&nbsp;},&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'MID':{'0101':'별,&nbsp;혜성',&nbsp;...,&nbsp;},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'SUB':{'010101':'별',&nbsp;&nbsp;'010102':&nbsp;'하나의&nbsp;별',&nbsp;'010103':&nbsp;'두&nbsp;개의&nbsp;별',&nbsp;...,&nbsp;}}</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">def</span>&nbsp;filtered_df(df):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;temp&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;df.copy()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;temp[<span style="color:#ffd500">'cond_a'</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;temp[<span style="color:#ffd500">'vienna_code'</span>].progress_map(lambda&nbsp;x:&nbsp;condition(x))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;df[(temp[<span style="color:#ffd500">'vienna_code'</span>].isin(desc.keys()))&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">&amp;</span>&nbsp;(temp[<span style="color:#ffd500">'cond_a'</span>]<span style="color:#0086b3"></span><span style="color:#ff3399">!</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">True</span>)].reset_index(drop<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">True</span>)</div></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>
    <br>
    <p>yolo split 데이터 생성 코드 일부</p>
    <div class="colorscripter-code" style="color:#f0f0f0;font-family:나눔고딕코딩 !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #4f4f4f"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#aaa;font-family:나눔고딕코딩 !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div><div style="line-height:130%">17</div><div style="line-height:130%">18</div><div style="line-height:130%">19</div><div style="line-height:130%">20</div><div style="line-height:130%">21</div><div style="line-height:130%">22</div><div style="line-height:130%">23</div><div style="line-height:130%">24</div><div style="line-height:130%">25</div><div style="line-height:130%">26</div><div style="line-height:130%">27</div><div style="line-height:130%">28</div><div style="line-height:130%">29</div><div style="line-height:130%">30</div><div style="line-height:130%">31</div><div style="line-height:130%">32</div><div style="line-height:130%">33</div><div style="line-height:130%">34</div><div style="line-height:130%">35</div><div style="line-height:130%">36</div><div style="line-height:130%">37</div><div style="line-height:130%">38</div><div style="line-height:130%">39</div><div style="line-height:130%">40</div><div style="line-height:130%">41</div><div style="line-height:130%">42</div><div style="line-height:130%">43</div><div style="line-height:130%">44</div><div style="line-height:130%">45</div><div style="line-height:130%">46</div><div style="line-height:130%">47</div><div style="line-height:130%">48</div><div style="line-height:130%">49</div><div style="line-height:130%">50</div><div style="line-height:130%">51</div><div style="line-height:130%">52</div><div style="line-height:130%">53</div><div style="line-height:130%">54</div><div style="line-height:130%">55</div><div style="line-height:130%">56</div><div style="line-height:130%">57</div><div style="line-height:130%">58</div><div style="line-height:130%">59</div><div style="line-height:130%">60</div><div style="line-height:130%">61</div><div style="line-height:130%">62</div><div style="line-height:130%">63</div><div style="line-height:130%">64</div><div style="line-height:130%">65</div><div style="line-height:130%">66</div><div style="line-height:130%">67</div><div style="line-height:130%">68</div><div style="line-height:130%">69</div><div style="line-height:130%">70</div><div style="line-height:130%">71</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:나눔고딕코딩 !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">from</span>&nbsp;sklearn.model_selection&nbsp;<span style="color:#ff3399">import</span>&nbsp;train_test_split</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;shutil</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;yaml</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;os&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">def</span>&nbsp;data_split(part_df):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;part_df[<span style="color:#ffd500">'img_name'</span>].unique()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;X_train,&nbsp;X_test,&nbsp;y_train,&nbsp;y_test&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;train_test_split(X,&nbsp;X,&nbsp;test_size<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">0.</span><span style="color:#c10aff">2</span>,&nbsp;random_state<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">42</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;X_val,&nbsp;X_test,&nbsp;y_val,&nbsp;y_test&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;train_test_split(X_test,&nbsp;y_test,&nbsp;test_size<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">0.</span><span style="color:#c10aff">5</span>,&nbsp;random_state<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#c10aff">42</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;part_df.loc[part_df[<span style="color:#ffd500">'img_name'</span>].isin(X_train),&nbsp;<span style="color:#ffd500">'split'</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'Train'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;part_df.loc[part_df[<span style="color:#ffd500">'img_name'</span>].isin(X_val),&nbsp;<span style="color:#ffd500">'split'</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'Validation'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;part_df.loc[part_df[<span style="color:#ffd500">'img_name'</span>].isin(X_test),&nbsp;<span style="color:#ffd500">'split'</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'Test'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;part_df</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">def</span>&nbsp;write_bbox_files(df,&nbsp;split,&nbsp;classes,&nbsp;cond,&nbsp;data_name<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>f<span style="color:#ffd500">"{today}_nb13_traindata"</span>,&nbsp;class_info<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'all_classes'</span>):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;f<span style="color:#ffd500">'/home/mark17/workspace/src/ultralytics/{data_name}/{class_info}/labels/{split}'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;os.makedirs(path,&nbsp;exist_ok<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">True</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">for</span>&nbsp;i&nbsp;<span style="color:#ff3399">in</span>&nbsp;tqdm(<span style="color:#4be6fa">range</span>(<span style="color:#4be6fa">len</span>(df))):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;df.loc[i]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yolo_format&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;row.yolo_format</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;isinstance(yolo_format,&nbsp;<span style="color:#4be6fa">str</span>):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yolo_format&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;eval(yolo_format)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xc,&nbsp;yc,&nbsp;box_w,&nbsp;box_h&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;yolo_format</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img_meta&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;row.img_meta</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;isinstance(img_meta,&nbsp;<span style="color:#4be6fa">str</span>):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img_meta&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;eval(img_meta)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img_w,&nbsp;img_h&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;map(<span style="color:#4be6fa">int</span>,&nbsp;img_meta)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xc&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">/</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;img_w</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yc&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">/</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;img_h</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;box_w&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">/</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;img_w</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;box_h&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">/</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;img_h</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;Get&nbsp;image&nbsp;name</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img_name&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;row.img_name</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bbox_str&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'&nbsp;'</span>.join(list(map(<span style="color:#4be6fa">str</span>,&nbsp;[xc,&nbsp;yc,&nbsp;box_w,&nbsp;box_h])))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;txt_name&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;f<span style="color:#ffd500">'{path}/{img_name.split(".")[0]}.txt'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">with</span>&nbsp;<span style="color:#4be6fa">open</span>(txt_name,&nbsp;<span style="color:#ffd500">'a'</span>)&nbsp;<span style="color:#ff3399">as</span>&nbsp;f:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(f<span style="color:#ffd500">"{str(classes[f'{row[cond]}'])}&nbsp;{bbox_str}\n"</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">def</span>&nbsp;copy_images(df,&nbsp;split,&nbsp;data_name<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>f<span style="color:#ffd500">"{today}_nb13_traindata"</span>,&nbsp;class_info<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'all_classes'</span>):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#&nbsp;print(split,&nbsp;"copy_images&nbsp;:",&nbsp;vcode)</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;f<span style="color:#ffd500">'/home/mark17/workspace/src/ultralytics/{data_name}/{class_info}/images/{split}'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;os.makedirs(path,&nbsp;exist_ok<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">True</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">for</span>&nbsp;file_name&nbsp;<span style="color:#ff3399">in</span>&nbsp;tqdm(df[<span style="color:#ffd500">'img_name'</span>].unique()):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_path&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;os.path.join(<span style="color:#ffd500">"/mnt/datacore/2023_user_images/"</span>,&nbsp;file_name)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">try</span>:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;<span style="color:#ff3399">not</span>&nbsp;os.path.isfile(os.path.join(path,&nbsp;file_name)):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutil.copy(file_path,&nbsp;os.path.join(path,&nbsp;file_name))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">except</span>:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">pass</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">def</span>&nbsp;generate_split_data(df,&nbsp;cond<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'mid_vienna_code'</span>):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;df_copy&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;df.copy()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;classes&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;{vcode:i&nbsp;<span style="color:#ff3399">for</span>&nbsp;i,&nbsp;vcode&nbsp;<span style="color:#ff3399">in</span>&nbsp;enumerate(sorted(df_copy[cond].unique()))}</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;write_classes_yaml(classes)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;df_copy&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;data_split(df_copy)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">print</span>(f<span style="color:#ffd500">'{"="*30}&nbsp;CREATE&nbsp;&nbsp;ANNOTATION&nbsp;{"="*30}'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">for</span>&nbsp;split&nbsp;<span style="color:#ff3399">in</span>&nbsp;[<span style="color:#ffd500">"Train"</span>,&nbsp;<span style="color:#ffd500">"Validation"</span>,&nbsp;<span style="color:#ffd500">"Test"</span>]:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;split_df&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;df_copy[df_copy[<span style="color:#ffd500">'split'</span>]&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;split].reset_index(drop<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">True</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;copy_images(split_df,&nbsp;split)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write_bbox_files(split_df,&nbsp;split,&nbsp;classes,&nbsp;cond<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>cond)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">def</span>&nbsp;write_classes_yaml(classes,&nbsp;data_name<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>f<span style="color:#ffd500">"{today}_nb13_traindata"</span>,&nbsp;class_info<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#ffd500">'all_classes'</span>):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;f<span style="color:#ffd500">"/home/mark17/workspace/src/ultralytics/{data_name}/{class_info}/classes.yaml"</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;os.makedirs(os.path.dirname(path),&nbsp;exist_ok<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">True</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;data_yaml&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;dict(</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nc&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#4be6fa">len</span>(classes),</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classes&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;classes)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">with</span>&nbsp;<span style="color:#4be6fa">open</span>(path,&nbsp;<span style="color:#ffd500">'w'</span>)&nbsp;<span style="color:#ff3399">as</span>&nbsp;outfile:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yaml.dump(data_yaml,&nbsp;outfile,&nbsp;default_flow_style<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">True</span>)</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#4f4f4ftext-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

    <br><br>
    <h3>🎉 결과 및 성과</h3>
      <ul>
        <li> YOLO 목표 mAP 0.65 초과 달성 </li>
        <li> multi-label classification 모델 (24개) 평균 정확도 0.96  </li>
        <br>
      </ul>
    </ul>
